# Nexus Mail ç§»åŠ¨ç«¯ UI é€‚é… - Bug è®°å½•

> æœ¬æ–‡æ¡£ä¸“é—¨è®°å½•ç§»åŠ¨ç«¯ UI é€‚é…è¿‡ç¨‹ä¸­å‘ç°çš„ Bug åŠå…¶è§£å†³æ–¹æ¡ˆã€‚
> é€šç”¨ Bug è¯·å‚è€ƒ `BUGS_AND_SOLUTIONS.md`ã€‚

---

## ğŸ“Š Bug ç»Ÿè®¡

| çŠ¶æ€ | æ•°é‡ |
|------|------|
| ğŸ”´ å¾…ä¿®å¤ | 0 |
| ğŸŸ¢ å·²ä¿®å¤ | 7 |
| ğŸŸ¡ è¿›è¡Œä¸­ | 0 |

---

## ğŸ”´ å¾…ä¿®å¤

*æš‚æ— *

---

## ğŸŸ¡ è¿›è¡Œä¸­

*æš‚æ— *

---

## ğŸŸ¢ å·²ä¿®å¤

### Bug #1: SaveStatus ç±»å‹ä¸åŒ¹é…å¯¼è‡´ TS ç¼–è¯‘é”™è¯¯

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šGPT Code Review

**é—®é¢˜æè¿°**ï¼š
`ComposeModal.tsx` å®šä¹‰ `type SaveStatus = 'idle' | 'saving' | 'saved' | 'error'`ï¼ˆä¸å« `null`ï¼‰ï¼Œä½† `page.tsx` åˆå§‹åŒ–çŠ¶æ€ä¸º `useState<... | null>(null)`ï¼Œå¯¼è‡´ç±»å‹ä¸å…¼å®¹ã€‚

**å½±å“èŒƒå›´**ï¼š

- TypeScript ä¸¥æ ¼æ¨¡å¼ä¸‹ç¼–è¯‘å¤±è´¥
- å†™é‚®ä»¶å¼¹çª—çŠ¶æ€æ˜¾ç¤ºå¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
å°† `page.tsx` ç¬¬ 80 è¡Œåˆå§‹å€¼æ”¹ä¸º `'idle'`ï¼Œå¹¶å¯¼å…¥ `SaveStatus` ç±»å‹ï¼š

```typescript
import ComposeModal, { type SaveStatus } from './components/ComposeModal';
const [saveStatus, setSaveStatus] = useState<SaveStatus>('idle');
```

**ç›¸å…³æ–‡ä»¶**ï¼š`app/page.tsx`

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12)

---

### Bug #2: WebSocket cleanup ç«æ€å¯¼è‡´å†…å­˜æ³„æ¼

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šGPT Code Review

**é—®é¢˜æè¿°**ï¼š
`useEffect` cleanup ä¸­è°ƒç”¨ `socket?.close()` ä¼šè§¦å‘ `onclose` å›è°ƒï¼Œåè€…åˆè°ƒç”¨ `startPolling()` å’Œ `setTimeout(connect, 5000)`ã€‚ç»„ä»¶ unmount åè¿™äº›å®šæ—¶å™¨ä»åœ¨è¿è¡Œï¼Œé€ æˆï¼š

1. å†…å­˜æ³„æ¼
2. çŠ¶æ€æ›´æ–°åˆ°å·²å¸è½½ç»„ä»¶ï¼ˆReact è­¦å‘Šï¼‰
3. æ— æ„ä¹‰çš„ç½‘ç»œè¯·æ±‚

**å½±å“èŒƒå›´**ï¼š

- é¡µé¢å¯¼èˆªæ—¶åå°ä»æœ‰ç½‘ç»œè¯·æ±‚
- æ§åˆ¶å°å¯èƒ½å‡ºç° "Can't perform a React state update on an unmounted component" è­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ·»åŠ  `isMounted` å®ˆå«å˜é‡ï¼Œåœ¨ cleanup æ—¶è®¾ä¸º `false`ï¼Œ`onclose` ä¸­æ£€æŸ¥è¯¥å˜é‡ï¼š

```typescript
let isMounted = true;

socket.onclose = () => {
  if (!isMounted) return; // æ–°å¢å®ˆå«
  // ... åŸæœ‰é€»è¾‘
};

return () => {
  isMounted = false; // æ–°å¢
  // ... cleanup
};
```

**ç›¸å…³æ–‡ä»¶**ï¼š`app/page.tsx` (ç¬¬ 194-281 è¡Œ)

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12)

---

### Bug #3: loadEmails ç½‘ç»œé”™è¯¯æ—¶ loading çŠ¶æ€å¡æ­»

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šGPT Code Review

**é—®é¢˜æè¿°**ï¼š
`loadEmails()` å‡½æ•°ç¼ºå°‘ `try/finally`ï¼Œå½“ `fetch` æŠ›å‡ºç½‘ç»œé”™è¯¯æ—¶ï¼Œ`setLoading(false)` æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œå¯¼è‡´ï¼š

1. é‚®ä»¶åˆ—è¡¨ä¸€ç›´æ˜¾ç¤ºåŠ è½½çŠ¶æ€
2. æ‰¹é‡æ“ä½œæ¡æ— æ³•ä½¿ç”¨
3. ç”¨æˆ·æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œ

**å¤ç°æ­¥éª¤**ï¼š

1. æ–­å¼€ç½‘ç»œè¿æ¥
2. åˆ‡æ¢è´¦å·æˆ–æ–‡ä»¶å¤¹
3. è§‚å¯Ÿåˆ° loading çŠ¶æ€æ°¸è¿œä¸ç»“æŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ `try/finally` åŒ…è£¹ fetch é€»è¾‘ï¼Œç¡®ä¿ `setLoading(false)` æ€»ä¼šæ‰§è¡Œï¼š

```typescript
async function loadEmails() {
  setLoading(true);
  try {
    // ... fetch é€»è¾‘
  } catch (e) {
    console.error('Failed to load emails:', e);
  } finally {
    setLoading(false);
  }
}
```

**ç›¸å…³æ–‡ä»¶**ï¼š`app/page.tsx` (ç¬¬ 416-476 è¡Œ)

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12)

---

### Bug #4: iframe sandbox é˜»æ­¢è„šæœ¬æ‰§è¡Œå¯¼è‡´æ­»ä»£ç 

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šGPT Code Review

**é—®é¢˜æè¿°**ï¼š
`EmailDetail.tsx` ä¸­ iframe ä½¿ç”¨ `sandbox="allow-same-origin"` ä½†ä¸åŒ…å« `allow-scripts`ï¼Œå¯¼è‡´ `<script>` å—æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚å›¾ç‰‡æ‡’åŠ è½½è„šæœ¬æ˜¯æ­»ä»£ç ï¼Œç›¸å…³ CSS è§„åˆ™ï¼ˆ`img[data-lazy-src]`ï¼‰ä¹Ÿæ— æ•ˆã€‚

**å½±å“èŒƒå›´**ï¼š

- å›¾ç‰‡æ‡’åŠ è½½åŠŸèƒ½å®é™…æœªç”Ÿæ•ˆ
- ä»£ç ä¸­å­˜åœ¨è¯¯å¯¼æ€§çš„æ— æ•ˆä»£ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ é™¤æ— æ•ˆçš„è„šæœ¬å’Œç›¸å…³ CSSï¼Œå› ä¸ºæ·»åŠ  `allow-scripts` æœ‰å®‰å…¨é£é™©ï¼ˆå¯èƒ½æ‰§è¡Œæ¶æ„é‚®ä»¶ä¸­çš„ JSï¼‰ã€‚æµè§ˆå™¨åŸç”Ÿ `loading="lazy"` å±æ€§å·²è¶³å¤Ÿã€‚

åˆ é™¤å†…å®¹ï¼š

- `img[data-lazy-src]` ç›¸å…³ CSS è§„åˆ™
- æ•´ä¸ª `<script>` å—ï¼ˆçº¦ 22 è¡Œï¼‰

**ç›¸å…³æ–‡ä»¶**ï¼š`app/components/EmailDetail.tsx`

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12)

---

### Bug #5: CSS å±‚å é¡ºåºå¯¼è‡´ç§»åŠ¨ç«¯åª’ä½“æŸ¥è¯¢å¤±æ•ˆ

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šç§»åŠ¨ç«¯éªŒè¯æµ‹è¯•

**é—®é¢˜æè¿°**ï¼š
M2 æ·»åŠ çš„ç§»åŠ¨ç«¯åª’ä½“æŸ¥è¯¢ `.sidebar { display: none }` ä¸ç”Ÿæ•ˆï¼Œç§»åŠ¨ç«¯ Sidebar ä»ç„¶æ˜¾ç¤ºã€‚

**é—®é¢˜åŸå› **ï¼ˆä¸¤ä¸ªï¼‰ï¼š

1. **`@supports` å—æœªå…³é—­**ï¼š`globals.css` ç¬¬ 67-71 è¡Œçš„ `@supports (height: 100dvh)` ç¼ºå°‘é—­åˆ `}`ï¼Œå¯¼è‡´åç»­æ‰€æœ‰ CSSï¼ˆåŒ…æ‹¬åª’ä½“æŸ¥è¯¢ï¼‰éƒ½è¢«åµŒå¥—åœ¨è¯¥å—å†…ã€‚
2. **CSS å±‚å é¡ºåº**ï¼šåª’ä½“æŸ¥è¯¢ï¼ˆç¬¬ 556-566 è¡Œï¼‰åœ¨ `.sidebar` å®šä¹‰ï¼ˆç¬¬ 883-889 è¡Œï¼‰ä¹‹å‰ï¼Œåè€…çš„ `display: flex` è¦†ç›–äº†åª’ä½“æŸ¥è¯¢çš„ `display: none`ã€‚

**å¤ç°æ­¥éª¤**ï¼š

1. è®¿é—® `http://localhost:3000`
2. ä½¿ç”¨ Chrome DevTools åˆ‡æ¢åˆ° iPhone æ¨¡æ‹Ÿå™¨ï¼ˆ<768pxï¼‰
3. è§‚å¯Ÿ Sidebar ä»ç„¶æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. å…³é—­ `@supports` å—ï¼ˆç¬¬ 71 è¡Œæ·»åŠ  `}`ï¼‰
2. å°†åª’ä½“æŸ¥è¯¢ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾
3. ä½¿ç”¨ `!important` ç¡®ä¿è¦†ç›–

```css
/* æ–‡ä»¶æœ«å°¾ */
@media (max-width: 768px) {
    .sidebar {
        display: none !important;
    }
}
```

**ç›¸å…³æ–‡ä»¶**ï¼š`app/globals.css`

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12 23:35)

---

### Bug #6: setSaveStatus(null) ç±»å‹å›å½’

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šGPT Code Review (ç¬¬äºŒè½®)

**é—®é¢˜æè¿°**ï¼š
`page.tsx` ç¬¬ 649 è¡Œçš„ `discardDraft()` å‡½æ•°ä¸­ä»æœ‰ `setSaveStatus(null)`ï¼Œä½†çŠ¶æ€ç±»å‹å·²æ”¹ä¸º `SaveStatus`ï¼ˆä¸å« `null`ï¼‰ï¼Œå¯¼è‡´ç±»å‹é”™è¯¯å›å½’ã€‚

**å½±å“èŒƒå›´**ï¼š

- TypeScript ä¸¥æ ¼æ¨¡å¼ä¸‹ç¼–è¯‘å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
å°† `setSaveStatus(null)` æ”¹ä¸º `setSaveStatus('idle')`ã€‚

**ç›¸å…³æ–‡ä»¶**ï¼š`app/page.tsx` (ç¬¬ 649 è¡Œ)

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12 23:50)

---

### Bug #7: é‡å¤çš„ @media å—å¯¼è‡´æ­»ä»£ç 

**å‘ç°æ—¥æœŸ**ï¼š2026-01-12
**æ¥æº**ï¼šGPT Code Review (ç¬¬äºŒè½®)

**é—®é¢˜æè¿°**ï¼š
`globals.css` ä¸­æœ‰ä¸¤ä¸ª `@media (max-width: 768px)` å—ï¼š

- ç¬¬ 557 è¡Œï¼šä¸å« `!important`ï¼Œè¢«åé¢çš„ `.sidebar` è§„åˆ™è¦†ç›–
- ç¬¬ 1401 è¡Œï¼šå« `!important`ï¼Œå®é™…ç”Ÿæ•ˆ

ç¬¬ä¸€ä¸ªå—æ˜¯æ­»ä»£ç ï¼Œä¼šé€ æˆç»´æŠ¤æ··ä¹±ã€‚

**å½±å“èŒƒå›´**ï¼š

- CSS æ–‡ä»¶ä¸­å­˜åœ¨æ— æ•ˆä»£ç 
- æœªæ¥ä¿®æ”¹æ—¶å¯èƒ½äº§ç”Ÿæ­§ä¹‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ é™¤ç¬¬ 557-566 è¡Œçš„ç¬¬ä¸€ä¸ª @media å—ï¼Œä¿ç•™æ³¨é‡Šè¯´æ˜åª’ä½“æŸ¥è¯¢å·²ç§»è‡³æ–‡ä»¶æœ«å°¾ã€‚

**ç›¸å…³æ–‡ä»¶**ï¼š`app/globals.css`

**çŠ¶æ€**ï¼šğŸŸ¢ å·²ä¿®å¤ (2026-01-12 23:50)

---

## ğŸ“ Bug æ¨¡æ¿

å¤åˆ¶ä»¥ä¸‹æ¨¡æ¿è®°å½•æ–° Bugï¼š

```markdown
## ğŸ› Bug #[åºå·]: [ç®€çŸ­æ ‡é¢˜]

### é—®é¢˜æè¿°

[è¯¦ç»†æè¿°é—®é¢˜ç°è±¡ï¼ŒåŒ…æ‹¬åœ¨å“ªä¸ªè®¾å¤‡/æ–­ç‚¹å‡ºç°]

### æˆªå›¾/å½•å±

[å¦‚æœ‰æˆªå›¾ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨]

### å¤ç°æ­¥éª¤

1. è®¿é—® `http://localhost:3000`
2. è°ƒæ•´æµè§ˆå™¨å®½åº¦è‡³ `[xxx]px`
3. [å…·ä½“æ“ä½œ]
4. [è§‚å¯Ÿåˆ°çš„é—®é¢˜]

### å½±å“èŒƒå›´

- è®¾å¤‡ï¼š[ ] iPhone SE / [ ] iPhone 14 / [ ] Android / [ ] iPad / [ ] æ¡Œé¢ç«¯
- æµè§ˆå™¨ï¼š[ ] Chrome / [ ] Safari / [ ] Firefox
- æ–­ç‚¹ï¼š[ ] <768px / [ ] 768-1023px / [ ] â‰¥1024px

### é—®é¢˜åŸå› 

[åˆ†ææ ¹æœ¬åŸå› ï¼ŒåŒ…æ‹¬ä»£ç ä½ç½®]

### è§£å†³æ–¹æ¡ˆ

[è¯¦ç»†æè¿°è§£å†³æ–¹æ³•]

\`\`\`css
/* ç¤ºä¾‹ä»£ç  */
\`\`\`

### ç›¸å…³æ–‡ä»¶

- `app/globals.css` - [è¯´æ˜]
- `app/page.tsx` - [è¯´æ˜]

### éªŒè¯ç»“æœ

- [ ] iPhone Safari æµ‹è¯•é€šè¿‡
- [ ] Android Chrome æµ‹è¯•é€šè¿‡
- [ ] æ¡Œé¢ç«¯å¸ƒå±€æ— å½±å“

### çŠ¶æ€

ğŸŸ¢ å·²ä¿®å¤ / ğŸ”´ å¾…ä¿®å¤ / ğŸŸ¡ è¿›è¡Œä¸­
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ç§»åŠ¨ç«¯ UI é€‚é…å®æ–½è®¡åˆ’](./Nexus%20Mail%20ç§»åŠ¨ç«¯%20UI%20é€‚é…å®æ–½è®¡åˆ’.md)
- [ç§»åŠ¨ç«¯ UI é€‚é…æ–¹æ¡ˆ](./é‚®ç®±ç®¡ç†å‘˜åå°%20-%20ç§»åŠ¨ç«¯%20UI%20é€‚é…æ–¹æ¡ˆ.md)
- [é€šç”¨ Bug è®°å½•](./BUGS_AND_SOLUTIONS.md)
- [å¼€å‘å·¥ä½œæµ](./WORKFLOW_MOBILE_DEV.md)
- [Code Review å·¥ä½œæµ](./WORKFLOW_CODE_REVIEW.md)

---

*åˆ›å»ºæ—¥æœŸ: 2026-01-12*
*æœ€åæ›´æ–°: 2026-01-12 23:26*
